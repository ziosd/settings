'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.exitOnError=exitOnError;exports.load=load;var _joi=require('joi');var _joi2=_interopRequireDefault(_joi);var _mpath=require('mpath');var _mpath2=_interopRequireDefault(_mpath);var _lodash=require('lodash');var _loader=require('./loader');var _args=require('./args');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var message='gPlatform Settings - Schema Validation Error:';function exitOnError(){var title=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var code=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var verbose=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return function(err,value){var _console=console,error=_console.error;error(title);if(verbose){error('');error(err.stack.toString())}err.details.forEach(function(_ref){var type=_ref.type,message=_ref.message,path=_ref.path;error('');error('  Type:',type);error('  Message:',message);error('  Path:',path);error('')});process.exit(code)}}function load(_ref2){var app=_ref2.app,defaults=_ref2.defaults,variables=_ref2.variables,schema=_ref2.schema,commandLineInterface=_ref2.commandLineInterface,separator=_ref2.separator,regex=_ref2.regex,json=_ref2.json,buildValue=_ref2.buildValue,exit=_ref2.exit;var objectDefaults=(0,_lodash.isString)(defaults)?(0,_loader.toObject)(defaults,json):defaults;var settings=(0,_lodash.merge)(objectDefaults,(0,_loader.build)(variables,separator,regex,buildValue));if(app){settings=JSON.parse(app)}if(commandLineInterface){var args=process.argv.slice(2);settings=(0,_args.parse)(args,settings)}if(schema){var _joi$validate=_joi2.default.validate(settings,schema,{convert:true,presence:'required'}),error=_joi$validate.error,value=_joi$validate.value;settings=value;if(error){((0,_lodash.isFunction)(exit)?exit:exitOnError(message))(error,value)}}var get=function get(path,special,map){return _mpath2.default.get(path,settings,special,map)};return{settings:settings,get:get,schema:schema}}